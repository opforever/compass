<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Compass</title>
    <style>
        /* General Body Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #121212; /* Darker background for better contrast */
            color: #e0e0e0;
            text-align: center;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }

        #app {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 1rem;
            width: 100%;
            max-width: 400px;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 1px;
            color: #ffffff;
        }

        /* Compass Styles */
        #compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
        }

        .compass-rose {
            width: 280px;
            height: 280px;
            background: radial-gradient(circle, #3a3a3a, #2a2a2a);
            border-radius: 50%;
            border: 5px solid #444;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), inset 0 4px 10px rgba(0,0,0,0.7);
            transition: transform 0.2s linear; /* Smooth rotation */
        }

        /* Needle always points up, the rose rotates */
        .compass-rose::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 140px solid #e74c3c; /* Red needle tip */
            position: absolute;
            top: 0;
            z-index: 10;
        }
        
        /* Cardinal directions */
        .rose-text {
            position: absolute;
            font-size: 1.8em;
            font-weight: bold;
            color: #ccc;
            z-index: 5;
        }
        .rose-n { top: 10px; }
        .rose-s { bottom: 10px; }
        .rose-e { right: 20px; top: 50%; transform: translateY(-50%);}
        .rose-w { left: 20px; top: 50%; transform: translateY(-50%);}


        #heading {
            font-size: 3em;
            font-weight: 200;
            font-family: 'Courier New', Courier, monospace;
            color: #fff;
            margin: 0;
            background-color: #2a2a2a;
            padding: 10px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        /* UI Elements */
        #permission-btn {
            padding: 15px 30px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #3a9efb, #3498db);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        #permission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.5);
        }
        
        #permission-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.4);
        }

        #error-message {
            color: #e74c3c;
            font-weight: bold;
            background-color: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e74c3c;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Device Compass</h1>
        <div id="compass-container" class="hidden">
            <div class="compass-rose">
                <div class="rose-text rose-n">N</div>
                <div class="rose-text rose-e">E</div>
                <div class="rose-text rose-s">S</div>
                <div class="rose-text rose-w">W</div>
            </div>
            <p id="heading">--°</p>
        </div>
        
        <button id="permission-btn">Activate Compass</button>
        <p id="error-message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const compassContainer = document.getElementById('compass-container');
            const compassRose = document.querySelector('.compass-rose');
            const headingDisplay = document.getElementById('heading');
            const permissionBtn = document.getElementById('permission-btn');
            const errorMessage = document.getElementById('error-message');

            // Hide the error message initially
            errorMessage.classList.add('hidden');

            // Main entry point: Check for API support
            if ('DeviceOrientationEvent' in window && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS 13+ and other browsers that require explicit permission
                permissionBtn.addEventListener('click', requestPermissionForIOS);
            } else if ('DeviceOrientationEvent' in window) {
                 // Non-iOS 13+ devices that support the API without a button click
                permissionBtn.addEventListener('click', () => {
                   initCompass();
                   window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                });
            } else {
                // Browser does not support the API
                showError('Sorry, your browser does not support the Device Orientation API.');
            }

            function requestPermissionForIOS() {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            // Permission granted, set up the event listener
                            window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                            initCompass();
                        } else {
                            // Permission denied
                            showError('Permission to access device orientation was denied.');
                        }
                    })
                    .catch(error => {
                        showError(`An error occurred: ${error.message}`);
                        console.error(error);
                    });
            }

            function initCompass() {
                // Hide the button and show the compass UI
                permissionBtn.classList.add('hidden');
                compassContainer.classList.remove('hidden');
            }

            function handleOrientation(event) {
                // event.alpha is the compass direction in degrees (0-360)
                // 0 is North, 90 is East, 180 is South, 270 is West
                // We use webkitCompassHeading for iOS compatibility
                let alpha = event.alpha;
                if(typeof event.webkitCompassHeading !== "undefined") {
                    alpha = event.webkitCompassHeading; 
                }

                if (alpha !== null) {
                    // We rotate the compass rose instead of the needle.
                    // The needle (::before pseudo-element) always points "up" relative to the screen.
                    // The rose rotates underneath it to show the correct direction.
                    // The minus sign is because we rotate the background opposite to the device's turn.
                    compassRose.style.transform = `rotate(${-alpha}deg)`;
                    
                    // Update the text display
                    headingDisplay.textContent = `${Math.round(alpha)}°`;
                } else {
                    showError("Could not retrieve compass heading. Your device may not have a magnetometer.");
                }
            }

            function showError(message) {
                permissionBtn.classList.add('hidden');
                compassContainer.classList.add('hidden');
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
