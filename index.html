<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Compass</title>
    <style>
        /* General Body Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #121212;
            color: #e0e0e0;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }

        #app {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 1rem;
            width: 100%;
            max-width: 400px;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 1px;
            color: #ffffff;
        }

        /* Compass Styles */
        #compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
        }

        .compass-rose {
            width: 300px;
            height: 300px;
            background-color: #2c3e50;
            background-image:
                conic-gradient(from 90deg, 
                    rgba(255,255,255,0.4) 0deg, rgba(255,255,255,0.4) 1deg, transparent 1deg, transparent 89deg,
                    rgba(255,255,255,0.6) 89deg, rgba(255,255,255,0.6) 91deg, transparent 91deg, transparent 179deg,
                    rgba(255,255,255,0.4) 179deg, rgba(255,255,255,0.4) 181deg, transparent 181deg, transparent 269deg,
                    rgba(255,255,255,0.6) 269deg, rgba(255,255,255,0.6) 271deg, transparent 271deg, transparent 360deg
                ),
                conic-gradient(from 0deg, 
                    #bdc3c7 0deg, #bdc3c7 1deg, transparent 1deg, transparent 29deg,
                    #bdc3c7 29deg, #bdc3c7 31deg, transparent 31deg, transparent 59deg,
                    #bdc3c7 59deg, #bdc3c7 61deg, transparent 61deg, transparent 89deg,
                    #bdc3c7 89deg, #bdc3c7 91deg, transparent 91deg, transparent 360deg
                );
            border-radius: 50%;
            border: 10px solid #7f8c8d;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                0 0 10px rgba(0,0,0,0.5),
                inset 0 0 25px rgba(0,0,0,0.5);
        }
        
        /* Glassy effect overlay */
        .compass-rose::after {
            content: '';
            position: absolute;
            width: 90%;
            height: 90%;
            background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.2), rgba(255,255,255,0) 70%);
            border-radius: 50%;
        }

        #needle {
            width: 280px;
            height: 280px;
            position: absolute;
            z-index: 10;
            transition: transform 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); /* Smooth, slightly bouncy rotation */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* North pointer */
        #needle::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 140px solid #e74c3c;
            position: absolute;
            top: 0;
        }

        /* South pointer */
        #needle::after {
            content: '';
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 140px solid #ecf0f1;
            position: absolute;
            bottom: 0;
        }
        
        /* Pivot point */
        .pivot {
            width: 20px;
            height: 20px;
            background: #ecf0f1;
            border-radius: 50%;
            position: absolute;
            z-index: 11;
            border: 3px solid #34495e;
        }

        /* Cardinal directions */
        .rose-text {
            position: absolute;
            font-size: 1.5em;
            font-weight: 600;
            color: #ecf0f1;
            z-index: 5;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }
        .rose-n { top: 10px; }
        .rose-s { bottom: 10px; }
        .rose-e { right: 10px; top: 50%; transform: translateY(-50%); }
        .rose-w { left: 10px; top: 50%; transform: translateY(-50%); }

        /* Inter-cardinal directions */
        .rose-text-small {
            font-size: 1.1em;
            font-weight: 400;
        }
        .rose-ne { top: 50px; right: 50px; }
        .rose-se { bottom: 50px; right: 50px; }
        .rose-sw { bottom: 50px; left: 50px; }
        .rose-nw { top: 50px; left: 50px; }

        #heading {
            font-size: 3em;
            font-weight: 200;
            font-family: 'Courier New', Courier, monospace;
            color: #fff;
            margin: 0;
            background-color: #2a2a2a;
            padding: 10px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        /* UI Elements */
        #permission-btn {
            padding: 15px 30px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #3a9efb, #3498db);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        #permission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.5);
        }
        
        #permission-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.4);
        }

        #error-message {
            color: #e74c3c;
            font-weight: bold;
            background-color: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e74c3c;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Device Compass</h1>
        <div id="compass-container" class="hidden">
            <div class="compass-rose">
                <div id="needle"></div>
                <div class="pivot"></div>
                <div class="rose-text rose-n">N</div>
                <div class="rose-text rose-e">E</div>
                <div class="rose-text rose-s">S</div>
                <div class="rose-text rose-w">W</div>
                <div class="rose-text rose-text-small rose-ne">NE</div>
                <div class="rose-text rose-text-small rose-se">SE</div>
                <div class="rose-text rose-text-small rose-sw">SW</div>
                <div class="rose-text rose-text-small rose-nw">NW</div>
            </div>
            <p id="heading">--°</p>
        </div>
        
        <button id="permission-btn">Activate Compass</button>
        <p id="error-message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const compassContainer = document.getElementById('compass-container');
            const needle = document.getElementById('needle');
            const headingDisplay = document.getElementById('heading');
            const permissionBtn = document.getElementById('permission-btn');
            const errorMessage = document.getElementById('error-message');

            errorMessage.classList.add('hidden');

            if ('DeviceOrientationEvent' in window && typeof DeviceOrientationEvent.requestPermission === 'function') {
                permissionBtn.addEventListener('click', requestPermissionForIOS);
            } else if ('DeviceOrientationEvent' in window) {
                permissionBtn.addEventListener('click', () => {
                   initCompass();
                   window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                });
            } else {
                showError('Sorry, your browser does not support the Device Orientation API.');
            }

            function requestPermissionForIOS() {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                            initCompass();
                        } else {
                            showError('Permission to access device orientation was denied.');
                        }
                    })
                    .catch(error => {
                        showError(`An error occurred: ${error.message}`);
                        console.error(error);
                    });
            }

            function initCompass() {
                permissionBtn.classList.add('hidden');
                compassContainer.classList.remove('hidden');
            }

            function handleOrientation(event) {
                let alpha = event.alpha;
                if(typeof event.webkitCompassHeading !== "undefined") {
                    alpha = event.webkitCompassHeading; 
                }

                if (alpha !== null) {
                    // Rotate the needle to point to the correct direction (alpha)
                    // The compass rose background remains static.
                    needle.style.transform = `rotate(${alpha}deg)`;
                    
                    headingDisplay.textContent = `${Math.round(alpha)}°`;
                } else {
                    showError("Could not retrieve compass heading. Your device may not have a magnetometer.");
                }
            }

            function showError(message) {
                permissionBtn.classList.add('hidden');
                compassContainer.classList.add('hidden');
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>

